<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;xilihuasi.github.io&quot;,&quot;root&quot;:&quot;&#x2F;blog&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;blog&#x2F;images&quot;,&quot;scheme&quot;:&quot;Pisces&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="原文地址：A Complete React Redux Tutorial for 2019 原文作者：Dave Ceddia 译文出自：掘金翻译计划 本文永久链接：https:&#x2F;&#x2F;github.com&#x2F;xitu&#x2F;gold-miner&#x2F;blob&#x2F;master&#x2F;TODO1&#x2F;redux-tutorial.md 译者：xilihuasi 校对者：xionglong58、Fengziyin1234">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】2019 React Redux 完全指南">
<meta property="og:url" content="https://xilihuasi.github.io/blog/2019/04/09/2019/%E3%80%90%E8%AF%91%E3%80%912019-React-Redux-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="xilihuasi&#39;s blog">
<meta property="og:description" content="原文地址：A Complete React Redux Tutorial for 2019 原文作者：Dave Ceddia 译文出自：掘金翻译计划 本文永久链接：https:&#x2F;&#x2F;github.com&#x2F;xitu&#x2F;gold-miner&#x2F;blob&#x2F;master&#x2F;TODO1&#x2F;redux-tutorial.md 译者：xilihuasi 校对者：xionglong58、Fengziyin1234">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://daveceddia.com/images/complete-redux-tutorial-2019.png">
<meta property="og:image" content="https://daveceddia.com/images/counter-component.png">
<meta property="og:image" content="https://daveceddia.com/images/passing-props-down.png">
<meta property="og:image" content="https://daveceddia.com/images/passing-callbacks-down.png">
<meta property="og:image" content="https://daveceddia.com/images/twitter-user-data.png">
<meta property="og:image" content="https://daveceddia.com/images/twitter-hierarchy.png">
<meta property="og:image" content="https://daveceddia.com/images/redux-connected-twitter.png">
<meta property="og:image" content="https://daveceddia.com/images/counter-plain.png">
<meta property="og:image" content="https://daveceddia.com/images/add-redux-in-codesandbox.gif">
<meta property="og:image" content="https://daveceddia.com/images/error-expected-reducer-to-be-a-function.png">
<meta property="og:image" content="https://daveceddia.com/images/reducer-console-log.png">
<meta property="og:image" content="https://daveceddia.com/images/dispatching-redux-actions.png">
<meta property="og:image" content="https://daveceddia.com/images/handling-redux-actions.png">
<meta property="article:published_time" content="2019-04-09T20:24:27.000Z">
<meta property="article:modified_time" content="2021-06-01T15:09:23.812Z">
<meta property="article:author" content="xilihuasi">
<meta property="article:tag" content="掘金翻译计划">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Redux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://daveceddia.com/images/complete-redux-tutorial-2019.png">


<link rel="canonical" href="https://xilihuasi.github.io/blog/2019/04/09/2019/%E3%80%90%E8%AF%91%E3%80%912019-React-Redux-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;xilihuasi.github.io&#x2F;blog&#x2F;2019&#x2F;04&#x2F;09&#x2F;2019&#x2F;%E3%80%90%E8%AF%91%E3%80%912019-React-Redux-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97&#x2F;&quot;,&quot;path&quot;:&quot;2019&#x2F;04&#x2F;09&#x2F;2019&#x2F;【译】2019-React-Redux-完全指南&#x2F;&quot;,&quot;title&quot;:&quot;【译】2019 React Redux 完全指南&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>【译】2019 React Redux 完全指南 | xilihuasi's blog</title><script src="/blog/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">xilihuasi's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">forerver old, forerver can't cry</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#2019-React-Redux-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">2019 React Redux 完全指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E6%A6%82%E8%BF%B0-Redux-%E8%A6%81%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">视频概述 Redux 要点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%A0%E5%BA%94%E8%AF%A5%E7%94%A8-Redux-%E5%90%97%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">你应该用 Redux 吗？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%A0%E7%9F%A5%E9%81%93-React-%E5%90%97%EF%BC%9F"><span class="nav-number">1.2.1.</span> <span class="nav-text">你知道 React 吗？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="nav-number">1.3.</span> <span class="nav-text">Redux 的好处</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%A7%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E6%98%AF%E4%B8%80%E7%A7%8D%E7%97%9B%E8%8B%A6"><span class="nav-number">1.3.1.</span> <span class="nav-text">多级传递数据是一种痛苦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E9%82%BB%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="nav-number">1.3.2.</span> <span class="nav-text">相邻组件间的数据传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-React-Redux-%E5%B0%86%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%BB%BB%E4%BD%95%E7%BB%84%E4%BB%B6"><span class="nav-number">1.3.3.</span> <span class="nav-text">使用 React-Redux 将数据连接到任何组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE-Redux-%E6%9B%BF%E4%BB%A3%E5%93%81"><span class="nav-number">1.4.</span> <span class="nav-text">内置 Redux 替代品</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E6%9B%BF%E4%BB%A3%E5%93%81-The-React-Context-API"><span class="nav-number">1.4.1.</span> <span class="nav-text">Redux 替代品: The React Context API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%9B%BF%E4%BB%A3%E5%93%81%EF%BC%9A%E4%BD%BF%E7%94%A8-children-Prop"><span class="nav-number">1.4.2.</span> <span class="nav-text">其他替代品：使用 children Prop</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0-Redux%EF%BC%8C%E4%BB%8E%E7%AE%80%E5%8D%95-React-%E5%BC%80%E5%A7%8B"><span class="nav-number">1.5.</span> <span class="nav-text">学习 Redux，从简单 React 开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%9F%E4%B8%8A%E6%9D%A5%EF%BC%81"><span class="nav-number">1.5.1.</span> <span class="nav-text">跟上来！</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-React-%E5%BA%94%E7%94%A8%E4%B8%AD%E6%B7%BB%E5%8A%A0-Redux"><span class="nav-number">1.6.</span> <span class="nav-text">在 React 应用中添加 Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-vs-react-redux"><span class="nav-number">1.6.1.</span> <span class="nav-text">redux vs react-redux</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-%E6%9C%89%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80-Store"><span class="nav-number">1.7.</span> <span class="nav-text">Redux 有全局唯一 Store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Redux-Store"><span class="nav-number">1.8.</span> <span class="nav-text">创建 Redux Store</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Store-%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA-Reducer"><span class="nav-number">1.8.1.</span> <span class="nav-text">Store 需要一个 Reducer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-Reducer-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.9.</span> <span class="nav-text">Redux Reducer 是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99-Reducer-%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81"><span class="nav-number">1.10.</span> <span class="nav-text">给 Reducer 一个初始状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dispatch-Actions-%E6%9D%A5%E6%94%B9%E5%8F%98-State"><span class="nav-number">1.11.</span> <span class="nav-text">Dispatch Actions 来改变 State</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-Redux-Action%EF%BC%9F"><span class="nav-number">1.11.1.</span> <span class="nav-text">什么是 Redux Action？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-Dispatch-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">1.12.</span> <span class="nav-text">Redux Dispatch 工作机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-Redux-Reducer-%E4%B8%AD%E5%A4%84%E7%90%86-Actions"><span class="nav-number">1.13.</span> <span class="nav-text">在 Redux Reducer 中处理 Actions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E7%BA%AF-Reducers"><span class="nav-number">1.14.</span> <span class="nav-text">如何保持纯 Reducers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E8%A7%84%E5%88%99"><span class="nav-number">1.15.</span> <span class="nav-text">全部规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8-React-%E4%B8%AD%E4%BD%BF%E7%94%A8-Redux"><span class="nav-number">1.16.</span> <span class="nav-text">如何在 React 中使用 Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Redux-Provider-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">1.16.1.</span> <span class="nav-text">React-Redux Provider 工作机制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA-Redux-%E5%87%86%E5%A4%87-Counter-%E7%BB%84%E4%BB%B6"><span class="nav-number">1.17.</span> <span class="nav-text">为 Redux 准备 Counter 组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E7%BB%84%E4%BB%B6%E5%92%8C-Redux"><span class="nav-number">1.18.</span> <span class="nav-text">连接组件和 Redux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-React-Redux-connect"><span class="nav-number">1.19.</span> <span class="nav-text">如何使用 React Redux connect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mapStateToProps-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">1.20.</span> <span class="nav-text">mapStateToProps 工作机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E4%BC%A0%E6%95%B4%E4%B8%AA-state%EF%BC%9F"><span class="nav-number">1.20.1.</span> <span class="nav-text">为什么不传整个 state？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E-React-%E7%BB%84%E4%BB%B6-Dispatch-Redux-Actions"><span class="nav-number">1.21.</span> <span class="nav-text">从 React 组件 Dispatch Redux Actions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%95%E8%AF%95%E8%BF%99%E4%B8%AA%EF%BC%81%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%87%8D%E7%BD%AE%E6%8C%89%E9%92%AE"><span class="nav-number">1.21.1.</span> <span class="nav-text">试试这个！加一个重置按钮</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Action-%E5%B8%B8%E9%87%8F"><span class="nav-number">1.22.</span> <span class="nav-text">Action 常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-Action-%E7%94%9F%E6%88%90%E5%99%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.23.</span> <span class="nav-text">Redux Action 生成器是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-React-Redux-mapDispatchToProps"><span class="nav-number">1.24.</span> <span class="nav-text">如何使用 React Redux mapDispatchToProps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-Redux-Thunk-%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.25.</span> <span class="nav-text">如何使用 Redux Thunk 获取数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%9Cthunk%E2%80%9D-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.25.1.</span> <span class="nav-text">“thunk” 是什么？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85-Redux-Thunk"><span class="nav-number">1.26.</span> <span class="nav-text">如何安装 Redux Thunk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E5%90%88-Redux-%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">1.27.</span> <span class="nav-text">结合 Redux 请求数据的例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dispatch-Action-%E6%9D%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.28.</span> <span class="nav-text">Dispatch Action 来获取数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%BB%99-Redux-Actions-%E5%91%BD%E5%90%8D"><span class="nav-number">1.28.1.</span> <span class="nav-text">如何给 Redux Actions 命名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux-%E4%B8%AD%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.29.</span> <span class="nav-text">Redux 中错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E6%B8%B2%E6%9F%93%E5%90%97%EF%BC%9F"><span class="nav-number">1.29.1.</span> <span class="nav-text">能避免重复渲染吗？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%91%A2%EF%BC%9F"><span class="nav-number">1.30.</span> <span class="nav-text">接下来呢？</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xilihuasi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xilihuasi.github.io/blog/2019/04/09/2019/%E3%80%90%E8%AF%91%E3%80%912019-React-Redux-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="xilihuasi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xilihuasi's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【译】2019 React Redux 完全指南
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-09 20:24:27" itemprop="dateCreated datePublished" datetime="2019-04-09T20:24:27+00:00">2019-04-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-01 15:09:23" itemprop="dateModified" datetime="2021-06-01T15:09:23+00:00">2021-06-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92/" itemprop="url" rel="index"><span itemprop="name">掘金翻译计划</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<ul>
<li>原文地址：<a target="_blank" rel="noopener" href="https://daveceddia.com/redux-tutorial/">A Complete React Redux Tutorial for 2019</a></li>
<li>原文作者：<a target="_blank" rel="noopener" href="https://daveceddia.com/">Dave Ceddia</a></li>
<li>译文出自：<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a></li>
<li>本文永久链接：<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner/blob/master/TODO1/redux-tutorial.md">https://github.com/xitu/gold-miner/blob/master/TODO1/redux-tutorial.md</a></li>
<li>译者：<a target="_blank" rel="noopener" href="https://github.com/xilihuasi">xilihuasi</a></li>
<li>校对者：<a target="_blank" rel="noopener" href="https://github.com/xionglong58">xionglong58</a>、<a target="_blank" rel="noopener" href="https://github.com/Fengziyin1234">Fengziyin1234</a></li>
</ul>
</blockquote>
<h1 id="2019-React-Redux-完全指南"><a href="#2019-React-Redux-完全指南" class="headerlink" title="2019 React Redux 完全指南"></a>2019 React Redux 完全指南</h1><p><img src="https://daveceddia.com/images/complete-redux-tutorial-2019.png" alt="A Complete Redux Tutorial (2019): why use it? - store - reducers - actions - thunks - data fetching"></p>
<p>想要理解 Redux 完整的工作机制真的让人头疼。特别是作为初学者。</p>
<p>术语太多了！Actions、reducers、action creators、middleware、pure functions、immutability、thunks 等等。</p>
<p>怎么把这些全都与 React 结合起来构建一个可运行的应用？</p>
<p>你可以花几个小时阅读博客以及尝试从复杂的“真实世界”应用中研习以将它拼凑起来。</p>
<p>在本篇 Redux 教程中，我会渐进地解释如何将 Redux 与 React 搭配使用 —— 从简单的 React 开始 —— 以及一个非常简单的 React + Redux 案例。我会解释<strong>为什么</strong>每个功能都很有用（以及什么情况下做取舍）。</p>
<p>接着我们会看到更加进阶的内容，手把手，直到你<strong>全部</strong>都理解为止。我们开始吧 :)</p>
<p>请注意：本教程<strong>相当齐全</strong>。也就意味篇幅着<strong>比较长</strong>。我把它变成了一个完整的免费课程，<strong>并且</strong>我制作了精美的 PDF 你可以在 iPad 或【任何 Android 设备】上阅读。留下你的邮箱地址即可立即获取。</p>
<h2 id="视频概述-Redux-要点"><a href="#视频概述-Redux-要点" class="headerlink" title="视频概述 Redux 要点"></a>视频概述 Redux 要点</h2><p>如果你更喜欢看视频而不是阅读，这个视频涵盖了如何在 React 应用中一步步添加 Redux：</p>
<p><a target="_blank" rel="noopener" href="https://youtu.be/sX3KeP7v7Kg">视频地址</a></p>
<p>这与本教程的第一部分相似，我们都会在一个简单 React 应用中逐步地添加 Redux。</p>
<p>或者，继续看下去！本教程不仅涵盖视频中的所有内容，还有其他干货。</p>
<h2 id="你应该用-Redux-吗？"><a href="#你应该用-Redux-吗？" class="headerlink" title="你应该用 Redux 吗？"></a>你应该用 Redux 吗？</h2><p>都 9102 年了，弄清楚你是否还应该使用 Redux 十分必要。现在有更好的替代品出现吗，使用 Hooks，Context 还是其他库？</p>
<p>简而言之：即使有很多替代品，<a target="_blank" rel="noopener" href="https://blog.isquaredsoftware.com/2018/03/redux-not-dead-yet/">Redux 仍旧不死</a>。但是是否适用于你的应用，还得看具体场景。</p>
<p>超级简单？只有一两个地方需要用到几个 state？组件内部 state 就很好了。你可以通过 classes，<a target="_blank" rel="noopener" href="https://daveceddia.com/intro-to-hooks/">Hooks</a> 或者二者一起来实现。</p>
<p>再复杂一点，有一些“全局”的东西需要在整个应用中共享？<a target="_blank" rel="noopener" href="https://daveceddia.com/context-api-vs-redux/">Context API</a> 可能完美适合你。</p>
<p>很多全局的 state，与应用的各独立部分都有交互？或者一个大型应用并且随着时间推移只会越来越大？试试 Redux 吧。</p>
<p>你也可以<strong>以后</strong>再使用 Redux，不必在第一天就决定。从简单开始，在你需要的时候再增加复杂性。</p>
<h3 id="你知道-React-吗？"><a href="#你知道-React-吗？" class="headerlink" title="你知道 React 吗？"></a>你知道 React 吗？</h3><p>React 可以脱离 Redux 单独使用。Redux 是 React 的<strong>附加项</strong>。</p>
<p>即使你打算同时使用它们，我还是强烈建议先<strong>脱离</strong> Redux 学习纯粹的 React。理解 props，state 以及单向数据流，在学习 Redux 之前先学习 “React 编程思想”。同时学习这两个肯定会把你搞晕。</p>
<p>如果你想要入门 React ，我整理了一个为期 5 天的免费课程，教授所有基础知识：</p>
<p>接下来的 5 天通过构建一些简单的应用来学习 React。</p>
<p>第一课</p>
<h2 id="Redux-的好处"><a href="#Redux-的好处" class="headerlink" title="Redux 的好处"></a>Redux 的好处</h2><p>如果你稍微使用过一段时间的 React，你可能就了解了 props 和单向数据流。数据通过 props 在组件树间向<strong>下</strong>传递。就像这个组件一样：</p>
<p><img src="https://daveceddia.com/images/counter-component.png" alt="Counter component"></p>
<p><code>count</code> 存在 <code>App</code> 的 state 里，会以 prop 的形式向下传递：</p>
<p><img src="https://daveceddia.com/images/passing-props-down.png" alt="Passing props down"></p>
<p>要想数据向<strong>上</strong>传递，需要通过回调函数实现，因此必须首先将回调函数向<strong>下</strong>传递到任何想通过调用它来传递数据的组件中。</p>
<p><img src="https://daveceddia.com/images/passing-callbacks-down.png" alt="Passing callbacks down"></p>
<p>你可以把数据想象成<strong>电流</strong>，通过彩色电线连接需要它的组件。数据通过线路上下流动，但是线路不能在空气中贯穿 —— 它们必须从一个组件连接到另一个组件。</p>
<h3 id="多级传递数据是一种痛苦"><a href="#多级传递数据是一种痛苦" class="headerlink" title="多级传递数据是一种痛苦"></a>多级传递数据是一种痛苦</h3><p>迟早你会陷入这类场景，顶级容器组件有一些数据，有一个 4 级以上的子组件需要这些数据。这有一个 Twitter 的例子，所有头像都圈出来了：</p>
<p><img src="https://daveceddia.com/images/twitter-user-data.png" alt="Twitter user data"></p>
<p>我们假设根组件 <code>App</code> 的 state 有 <code>user</code> 对象。该对象包含当前用户头像、昵称和其他资料信息。</p>
<p>为了把 <code>user</code> 数据传递给全部 3 个 <code>Avatar</code> 组件，必须要经过一堆并不需要该数据的中间组件。</p>
<p><img src="https://daveceddia.com/images/twitter-hierarchy.png" alt="Sending the user data down to the Avatar components"></p>
<p>获取数据就像用针在采矿探险一样。等等，那根本没有意义。无论如何，<strong>这很痛苦</strong>。也被称为 “prop-drilling”。</p>
<p>更重要的是，这不是好的软件设计。中间组件被迫接受和传递他们并不关心的 props。也就意味着重构和重用这些组件会变得比原本更难。</p>
<p>如果不需要这些数据的组件根本不用看到它们的话不是很棒吗？</p>
<p>Redux 就是解决这个问题的一种方法。</p>
<h3 id="相邻组件间的数据传递"><a href="#相邻组件间的数据传递" class="headerlink" title="相邻组件间的数据传递"></a>相邻组件间的数据传递</h3><p>如果你有些兄弟组件需要共享数据，React 的方式是把数据向<strong>上</strong>传到父组件中，然后再通过 props 向下传递。</p>
<p>但这可能很麻烦。Redux 会为你提供一个可以存储数据的全局 “parent”，然后你可以通过 React-Redux 把兄弟组件和数据 <code>connect</code> 起来。</p>
<h3 id="使用-React-Redux-将数据连接到任何组件"><a href="#使用-React-Redux-将数据连接到任何组件" class="headerlink" title="使用 React-Redux 将数据连接到任何组件"></a>使用 React-Redux 将数据连接到任何组件</h3><p>使用 <code>react-redux</code> 的 <code>connect</code> 函数，你可以将任何组件插入 Redux 的 store 以及取出需要的数据。</p>
<p><img src="https://daveceddia.com/images/redux-connected-twitter.png" alt="Connecting Redux to the Avatar components"></p>
<p>Redux 还做了一些很酷的事情，比如使调试更轻松（Redux DevTools 让你检查每一个 state 的变化），time-travel debugging（你可以<strong>回滚</strong> state 变化，看看你的应用以前的样子），从长远来看，它让代码变得更易于维护。它也会教你更多关于函数式编程的知识。</p>
<h2 id="内置-Redux-替代品"><a href="#内置-Redux-替代品" class="headerlink" title="内置 Redux 替代品"></a>内置 Redux 替代品</h2><p>如果 Redux 对你来说太过繁琐了，可以看看这些替代品。它们内置在 React 中。</p>
<h3 id="Redux-替代品-The-React-Context-API"><a href="#Redux-替代品-The-React-Context-API" class="headerlink" title="Redux 替代品: The React Context API"></a>Redux 替代品: The React Context API</h3><p>在底层，React-Redux 使用 React 内置的 Context API 来传递数据。如果你愿意，你可以跳过 Redux 直接使用 Context。你会错过上面提到的 Redux 很棒的特性，但是如果你的应用很简单并且想用简单的方式传递数据，Context 就够了。</p>
<p>既然你读到这里，我认为你真想学习 Redux，我不会在这里<a target="_blank" rel="noopener" href="https://daveceddia.com/context-api-vs-redux/">比较 Redux 和 Context API</a> 或者<a target="_blank" rel="noopener" href="https://daveceddia.com/usecontext-hook/">使用 Context</a> 和<a target="_blank" rel="noopener" href="https://daveceddia.com/usereducer-hook-examples/">使用 Reducer</a> Hooks。你可以点击链接详细了解。</p>
<p>如果你想深入研究 Context API，看我在 egghead 的课程 <a target="_blank" rel="noopener" href="https://egghead.io/courses/react-context-for-state-management">React Context 状态管理</a></p>
<h3 id="其他替代品：使用-children-Prop"><a href="#其他替代品：使用-children-Prop" class="headerlink" title="其他替代品：使用 children Prop"></a>其他替代品：使用 <code>children</code> Prop</h3><p>取决于你构建应用程序的方式，你可能会用更直接的方式把数据传递给子组件，那就是使用 <code>children</code> 和其他 props 结合的方式作为“插槽”。如果你组织的方式正确，就可以有效地跳过层次结构中的几个层级。</p>
<p>我有一篇相关文章 <a target="_blank" rel="noopener" href="https://daveceddia.com/pluggable-slots-in-react-components/">“插槽”模式以及如何组织组件树</a> 来有效地传递数据。</p>
<h2 id="学习-Redux，从简单-React-开始"><a href="#学习-Redux，从简单-React-开始" class="headerlink" title="学习 Redux，从简单 React 开始"></a>学习 Redux，从简单 React 开始</h2><p>我们将采用增量的方法，从带有组件 state 的简单 React 应用开始，一点点添加 Redux，以及解决过程中遇到的错误。我们称之为“错误驱动型开发” :)</p>
<p>这是一个计数器：</p>
<p><img src="https://daveceddia.com/images/counter-plain.png" alt="Counter component"></p>
<p>这本例中，Counter 组件有 state，包裹着它的 App 是一个简单包装器。</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="built_in">this</span>.state.count - <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.decrement&#125;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;this.state.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.increment&#125;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br></pre></td></tr></table></figure>

<p>快速回顾一下，它是如何运行的：</p>
<ul>
<li><code>count</code> state 存储在 <code>Counter</code> 组件</li>
<li>当用户点击 “+” 时，会调用按钮的 <code>onClick</code> 处理器执行 <code>increment</code> 函数。</li>
<li><code>increment</code> 函数会更新 state 的 count 值。</li>
<li>因为 state 改变了，React 会重新渲染 <code>Counter</code> 组件（以及它的子元素），这样就会显示新计数值。</li>
</ul>
<p>如果你想要了解 state 变化机制的更多细节，去看 <a target="_blank" rel="noopener" href="https://daveceddia.com/visual-guide-to-state-in-react/">React 中的 state 可视指南</a>然后再回到这里。</p>
<p>不过说实话：如果上面内容对你来讲<strong>不是</strong>复习的话，你需要在学 Redux <strong>之前</strong>了解下 React 的 state 如何工作，否则你会巨困惑。参加我<a target="_blank" rel="noopener" href="https://daveceddia.com/pure-react-email-course">免费的 5 天 React 课程</a>，用简单的 React 获得信心，然后再回到这里。</p>
<h3 id="跟上来！"><a href="#跟上来！" class="headerlink" title="跟上来！"></a>跟上来！</h3><p>最好的学习方式就是动手尝试！所以这有个 CodeSandbox 你可以跟着做：</p>
<p>–&gt; <a target="_blank" rel="noopener" href="https://codesandbox.io/s/98153xy79w">在新 tab 中打开 CodeSandbox</a></p>
<p>我强烈建议你将 CodeSandbox 与该教程保持同步并且随着你进行时实际动手敲出这些例子。</p>
<h2 id="在-React-应用中添加-Redux"><a href="#在-React-应用中添加-Redux" class="headerlink" title="在 React 应用中添加 Redux"></a>在 React 应用中添加 Redux</h2><p>在 CodeSandbox 中，展开左侧的 Dependencies 选项，然后点击 Add Dependency。</p>
<p>搜索 <code>redux</code> 添加依赖，然后再次点击 Add Dependency 搜索 <code>react-redux</code> 添加。</p>
<p><img src="https://daveceddia.com/images/add-redux-in-codesandbox.gif"></p>
<p>在本地项目，你可以通过 Yarn 或者 NPM 安装：<code>npm install --save redux react-redux</code>。</p>
<h3 id="redux-vs-react-redux"><a href="#redux-vs-react-redux" class="headerlink" title="redux vs react-redux"></a>redux vs react-redux</h3><p><code>redux</code> 给你一个 store，让你可以在里面保存 state，取出 state，以及当 state 发生改变时做出响应。但那就是它所有能做的事。</p>
<p>实际上是 <code>react-redux</code> 把各个 state 和 React 组件连接起来。</p>
<p>没错：<code>redux</code> 对 React <strong>根本</strong>不了解。</p>
<p>虽然，这两个库就像豆荚里的两个豌豆。99.999% 的情况下，当任何人在 React 的场景下提到 “Redux”，他们指的是这两个库。因此当你在 StackOverflow、Reddit 或者其他地方看到 Redux 时，记住这一点。</p>
<p><code>redux</code> 库可以脱离 React 应用使用。它可以和 Vue、Angular 甚至后端的 Node/Express 应用一起使用。</p>
<h2 id="Redux-有全局唯一-Store"><a href="#Redux-有全局唯一-Store" class="headerlink" title="Redux 有全局唯一 Store"></a>Redux 有全局唯一 Store</h2><p>我们将首先从 Redux 中的一小部分入手：store。</p>
<p>我们已经讨论过 Redux 怎样在一个独立 store 里保存你应用的 state。以及怎样提取 state 的一部分把它作为 props 嵌入你的组件。</p>
<p>你会经常看到 “state” 和 “store” 这两个词互换使用。技术上来讲，state 是数据，store 是保存数据的地方。</p>
<p>因此：作为我们从简单的 React 到 Redux 重构的第一步，我们要创建一个 store 来保持 state。</p>
<h2 id="创建-Redux-Store"><a href="#创建-Redux-Store" class="headerlink" title="创建 Redux Store"></a>创建 Redux Store</h2><p>Redux 有一个很方便的函数用来创建 stores，叫做 <code>createStore</code>。很合逻辑，嗯？</p>
<p>我们在 <code>index.js</code> 中创建一个 store。引入 <code>createStore</code> 然后像这样调用：</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这样会遇到 “Expected the reducer to be a function.” 错误。</p>
<p><img src="https://daveceddia.com/images/error-expected-reducer-to-be-a-function.png" alt="Error: Expected the reducer to be a function."></p>
<h3 id="Store-需要一个-Reducer"><a href="#Store-需要一个-Reducer" class="headerlink" title="Store 需要一个 Reducer"></a>Store 需要一个 Reducer</h3><p>因此，有件关于 Redux 的事：它并不是非常智能。</p>
<p>你可能期待通过创建一个 store，它会给你的 state 一个合适的默认值。或许是一个空对象？</p>
<p>但是并非如此。这里没有约定优于配置。</p>
<p>Redux <strong>不会</strong>对你的 state 做任何假设。它可能是一个 object、number、string，或者任何你需要的。这取决于你。</p>
<p>我们必须提供一个返回 state 的函数。这个函数被称为 reducer（我们马上就知道为什么了）。那么我们创建一个非常简单的 reducer，把它传给 <code>createStore</code>，然后看会发生什么：</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;reducer&#x27;</span>, state, action);</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br></pre></td></tr></table></figure>

<p>修改完后，打开控制台（在 CodeSandbox 里，点击底部的 Console 按钮）。</p>
<p>你应该可以看到类似这样的日志信息：</p>
<p><img src="https://daveceddia.com/images/reducer-console-log.png" alt="reducer undefined Object { type: @@redux/INIT }"></p>
<p>（INIT 后面的字母和数字是 Redux 随机生成的）</p>
<p>注意在你创建 store 的同时 Redux 如何调用你的 reducer。（为了证实这点：调用 <code>createStore</code> 之后立即输出 <code>console.log</code>，看看 reducer 后面会打印什么）</p>
<p>同样注意 Redux 如何传递了一个 <code>undefined</code> 的 <code>state</code>，同时 action 是一个有 <code>type</code> 属性的对象。</p>
<p>我们稍后会更多地讨论 actions。现在，我们先看看 <strong>reducer</strong>。</p>
<h2 id="Redux-Reducer-是什么？"><a href="#Redux-Reducer-是什么？" class="headerlink" title="Redux Reducer 是什么？"></a>Redux Reducer 是什么？</h2><p>“reducer” 术语看起来可能有点陌生和害怕，但是本节过后，我认为你会同意如下观点，正如俗话所说的那样，“只是一个函数”。</p>
<p>你用过数组的 <code>reduce</code> 函数吗？</p>
<p>它是这样用的：你传入一个函数，遍历数组的每一个元素时都会调用你传入的函数，类似 <code>map</code> 的作用 —— 你可能在 React 里面渲染列表而对 <code>map</code> 很熟悉。</p>
<p>你的函数调用时会接收两个参数：上一次迭代的结果，和当前数组元素。它结合当前元素和之前的 “total” 结果然后返回新的 total 值。</p>
<p>结合下面例子看会更加清晰明了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letters = [<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;x&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// `reduce` 接收两个参数:</span></span><br><span class="line"><span class="comment">//   - 一个用来 reduce 的函数 (也称为 &quot;reducer&quot;)</span></span><br><span class="line"><span class="comment">//   - 一个计算结果的初始值</span></span><br><span class="line"><span class="keyword">var</span> word = letters.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">accumulatedResult, arrayItem</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> accumulatedResult + arrayItem;</span><br><span class="line">&#125;, <span class="string">&#x27;&#x27;</span>); <span class="comment">// &lt;-- 注意这个空字符串：它是初始值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(word); <span class="comment">// =&gt; &quot;redux&quot;</span></span><br></pre></td></tr></table></figure>

<p>你给 <code>reduce</code> 传入的函数理所应当被叫做 “reducer”，因为它将整个数组的元素 <strong>reduces</strong> 成一个结果。</p>
<p>Redux <strong>基本上</strong>是数组 <code>reduce</code> 的豪华版。前面，你看到 Redux reducers 如何拥有这个显著特征：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(state, action) =&gt; newState;</span><br></pre></td></tr></table></figure>

<p>含义：它接收当前 <code>state</code> 和一个 <code>action</code>，然后返回 <code>newState</code>。看起来很像 <code>Array.reduce</code> 里 reducer 的特点！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(accumulatedValue, nextItem) =&gt; nextAccumulatedValue;</span><br></pre></td></tr></table></figure>

<p>Redux reducers 就像你传给 Array.reduce 的函数作用一样！:) 它们 reduce 的是 actions。它们把一组 actions（随着时间）reduce 成一个单独的 state。不同之处在于 Array 的 reduce 立即发生，而 Redux 则随着正运行应用的生命周期一直发生。</p>
<p>如果你仍然非常不确定，查看下我的 [Redux reducers 工作机制]指南(<a target="_blank" rel="noopener" href="https://daveceddia.com/what-is-a-reducer/)%E3%80%82%E4%B8%8D%E7%84%B6%E7%9A%84%E8%AF%9D%EF%BC%8C%E6%88%91%E4%BB%AC%E7%BB%A7%E7%BB%AD%E5%90%91%E4%B8%8B%E7%9C%8B%E3%80%82">https://daveceddia.com/what-is-a-reducer/)。不然的话，我们继续向下看。</a></p>
<h2 id="给-Reducer-一个初始状态"><a href="#给-Reducer-一个初始状态" class="headerlink" title="给 Reducer 一个初始状态"></a>给 Reducer 一个初始状态</h2><p>记住 reducer 的职责是接收当前 <code>state</code> 和一个 <code>action</code> 然后返回新的 state。</p>
<p>它还有另一个职责：在首次调用的时候应该返回初始 state。它有点像应用的“引导页”。它必须从某处开始，对吧？</p>
<p>惯用的方式是定义一个 <code>initialState</code> 变量然后使用 ES6 默认参数给 <code>state</code> 赋初始值。</p>
<p>既然要把 <code>Counter</code> state 迁移到 Redux，我们先立马创建它的初始 state。在 <code>Counter</code> 组件里，我们的 state 是一个有 <code>count</code> 属性的对象，所以我们在这创建一个一样的 initialState。</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;reducer&#x27;</span>, state, action);</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你再看下控制台，你会看到 <code>state</code> 打印的值为 <code>&#123;count: 0&#125;</code>。那就是我们想要的。</p>
<p>所以这告诉我们一条关于 reducers 的重要规则。</p>
<p>Reducers 重要规则一：reducer 绝不能返回 undefined。</p>
<p>通常 state 应该总是已定义的。已定义的 state 是良好的 state。而<strong>未</strong>定义的则<strong>不</strong>那么好（并且会破坏你的应用）。</p>
<h2 id="Dispatch-Actions-来改变-State"><a href="#Dispatch-Actions-来改变-State" class="headerlink" title="Dispatch Actions 来改变 State"></a>Dispatch Actions 来改变 State</h2><p>是的，一下来了两个名字：我们将 “dispatch” 一些 “actions”。</p>
<h3 id="什么是-Redux-Action？"><a href="#什么是-Redux-Action？" class="headerlink" title="什么是 Redux Action？"></a>什么是 Redux Action？</h3><p>在 Redux 中，具有 <code>type</code> 属性的普通对象就被称为 action。就是这样，只要遵循这两个规则，它就是一个 action：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;add an item&quot;</span>,</span><br><span class="line">  <span class="attr">item</span>: <span class="string">&quot;Apple&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is also an action:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="number">7008</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here’s another one:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Actions 的格式非常自由。只要它是个带有 <code>type</code> 属性的对象就可以了。</p>
<p>为了保证事务的合理性和可维护性，我们 Redux 用户通常给 actions 的 type 属性赋简单字符串，并且通常是大写的，来表明它们是常量。</p>
<p>Action 对象描述你想做出的改变（如“增加 counter”）或者将触发的事件（如“请求服务失败并显示错误信息”）。</p>
<p>尽管 Actions 名声响亮，但它是无趣的，呆板的对象。它们事实上不<strong>做</strong>任何事情。反正它们自己不做。</p>
<p>为了让 action <strong>做</strong>点事情，你需要 dispatch。</p>
<h2 id="Redux-Dispatch-工作机制"><a href="#Redux-Dispatch-工作机制" class="headerlink" title="Redux Dispatch 工作机制"></a>Redux Dispatch 工作机制</h2><p>我们刚才创建的 store 有一个内置函数 <code>dispatch</code>。调用的时候携带 action，Redux 调用 reducer 时就会携带 action（然后 reducer 的返回值会更新 state）。</p>
<p>我们在 store 上试试看。</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span> &#125;);</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span> &#125;);</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;DECREMENT&#x27;</span> &#125;);</span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;RESET&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>在你的 CodeSandbox 中添加这些 dispatch 调用然后检查控制台</p>
<p><img src="https://daveceddia.com/images/dispatching-redux-actions.png" alt="reducer undefined Object { type: @@redux/INIT }"></p>
<p>每一次调用 <code>dispatch</code> 最终都会调用 reducer！</p>
<p>同样注意到 state 每次都一样？<code>&#123;count: 0&#125;</code> 一直没变。</p>
<p>这是因为我们的 reducer 没有<strong>作用于</strong>那些 actions。不过很容易解决。现在就开始吧。</p>
<h2 id="在-Redux-Reducer-中处理-Actions"><a href="#在-Redux-Reducer-中处理-Actions" class="headerlink" title="在 Redux Reducer 中处理 Actions"></a>在 Redux Reducer 中处理 Actions</h2><p>为了让 actions 做点事情，我们需要在 reducer 里面写几行代码来根据每个 action 的 <code>type</code> 值来对应得更新 state。</p>
<p>有几种方式实现。</p>
<p>你可以创建一个对象来通过 action 的 type 来查找对应的处理函数。</p>
<p>或者你可以写一大堆 if/else 语句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(action.type === <span class="string">&quot;INCREMENT&quot;</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(action.type === <span class="string">&quot;RESET&quot;</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者你可以用一个简单的 <code>switch</code> 语句，也是我下面采用的方式，因为它很直观，也是这种场景的常用方法。</p>
<p>尽管有些人讨厌 <code>switch</code>，如果你也是 —— 随意用你喜欢的方式写 reducers 就好 :)</p>
<p>下面是我们处理 actions 的逻辑：</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;reducer&#x27;</span>, state, action);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;INCREMENT&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">count</span>: state.count + <span class="number">1</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;DECREMENT&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">count</span>: state.count - <span class="number">1</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;RESET&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>试一下然后在控制台看看会输出什么。</p>
<p><img src="https://daveceddia.com/images/handling-redux-actions.png" alt="reducer undefined Object { type: @@redux/INIT }"></p>
<p>快看！<code>count</code> 变了!</p>
<p>我们准备好把它连接到 React 了，在此之前让我们先谈谈这段 reducer 代码。</p>
<h2 id="如何保持纯-Reducers"><a href="#如何保持纯-Reducers" class="headerlink" title="如何保持纯 Reducers"></a>如何保持纯 Reducers</h2><p>另一个关于 reducers 的规则是它们必须是纯函数。也就是说不能修改它们的参数，也不能有副作用（side effect）。</p>
<p>Reducer 规则二：Reducers 必须是纯函数。</p>
<p>“副作用（side effect）”是指对函数作用域之外的任何更改。不要改变函数作用域以外的变量，不要调用其他会改变的函数（比如 <code>fetch</code>，跟网络和其他系统有关），也不要 dispatch actions 等。</p>
<p>技术角度来看 <code>console.log</code> 是副作用（side effect），但是我们忽略它。</p>
<p>最重要的事情是：不要修改 <code>state</code> 参数。</p>
<p>这意味着你不能执行 <code>state.count = 0</code>、<code>state.items.push(newItem)</code>、<code>state.count++</code> 及其他类型的变动 —— 不要改变 <code>state</code> 本身，及其任何子属性。</p>
<p>你可以把它想成一个游戏，你唯一能做的事就是 <code>return &#123; ... &#125;</code>。这是个有趣的游戏。开始会有点恼人。但是通过练习你会变得更好。</p>
<p>我整理了一个<a target="_blank" rel="noopener" href="https://daveceddia.com/react-redux-immutability-guide/">如何在 Redux 里做 Immutable 更新</a>完全指南，包含更新 state 中对象和数组的七个通用模式。</p>
<p>安装 <a target="_blank" rel="noopener" href="https://github.com/mweststrate/immer">Immer</a> 在 reducers 里面使用也是一种很好的方式。Immer 让你可以像写普通 mutable 代码一样，最终会自动生成 immutable 代码。<a target="_blank" rel="noopener" href="https://daveceddia.com/react-redux-immutability-guide/#easy-state-updates-with-immer">点击了解如何使用 Immer</a>。</p>
<p>建议：如果你是开始一个全新的应用程序，一开始就使用 Immer。它会为你省去很多麻烦。但是我向你展示这种<strong>困难</strong>方式是因为很多代码仍然采用这种方式，你一定会看到没有用 Immer 写的 reducers</p>
<h2 id="全部规则"><a href="#全部规则" class="headerlink" title="全部规则"></a>全部规则</h2><p>必须返回一个 state，不要改变 state，不要 connect 每一个组件，要吃西兰花，11 点后不要外出…这简直没完没了。就像一个规则工厂，我甚至不知道那是什么。</p>
<p>是的，Redux 就像一个霸道的父母。但它是出于爱。函数式编程的爱。</p>
<p>Redux 建立在不变性的基础上，因为变化的全局 state 是一条通往废墟之路。</p>
<p>你试过在全局对象里面保存你的 state 吗？起初它还很好。美妙并且简单。任何东西都能接触到 state 因为它一直是可用的并且很容易更改。</p>
<p>然后 state 开始以不可预测的方式发生改变，想要找到改变它的代码变得几乎不可能。</p>
<p>为了避免这些问题，Redux 提出了以下规则。</p>
<ul>
<li>State 是只读的，唯一修改它的方式是 actions。</li>
<li>更新的唯一方式：dispatch(action) -&gt; reducer -&gt; new state。</li>
<li>Reducer 函数必须是“纯”的 —— 不能修改它的参数，也不能有副作用（side effect）。</li>
</ul>
<h2 id="如何在-React-中使用-Redux"><a href="#如何在-React-中使用-Redux" class="headerlink" title="如何在 React 中使用 Redux"></a>如何在 React 中使用 Redux</h2><p>此时我们有个很小的带有 <code>reducer</code> 的 <code>store</code>，当接收到 <code>action</code> 时它知道如何更新 <code>state</code>。</p>
<p>现在是时候将 Redux 连接到 React 了。</p>
<p>要做到这一点，要用到 <code>react-redux</code> 库的两样东西：一个名为 <code>Provider</code> 的组件和一个 <code>connect</code> 函数。</p>
<p>通过用 <code>Provider</code> 组件包装整个应用，如果它想的话，应用树里的<strong>每一个组件</strong>都可以访问 Redux store。</p>
<p>在 <code>index.js</code> 里，引入 <code>Provider</code> 然后用它把 <code>App</code> 的内容包装起来。<code>store</code> 会以 prop 形式传递。</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Counter</span>/&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这样之后，<code>Counter</code>， <code>Counter</code> 的子元素，以及子元素的子元素等等——所有这些现在都可以访问 Redux stroe。</p>
<p>但不是自动的。我们需要在我们的组件使用 <code>connect</code> 函数来访问 store。</p>
<h3 id="React-Redux-Provider-工作机制"><a href="#React-Redux-Provider-工作机制" class="headerlink" title="React-Redux Provider 工作机制"></a>React-Redux Provider 工作机制</h3><p><code>Provider</code> 可能看起来有一点点像魔法。它在底层实际是用了 React 的 <a target="_blank" rel="noopener" href="https://daveceddia.com/context-api-vs-redux/">Context 特性</a>。</p>
<p>Context 就像是连接每个组件的秘密通道，使用 <code>connect</code> 就可打开秘密通道的大门。</p>
<p>想象一下，在一堆煎饼上浇糖浆以及它铺满<strong>所有</strong>煎饼的方式，即使你只在最上层倒了糖浆。<code>Provider</code> 对 Redux 做了同样的事情。</p>
<h2 id="为-Redux-准备-Counter-组件"><a href="#为-Redux-准备-Counter-组件" class="headerlink" title="为 Redux 准备 Counter 组件"></a>为 Redux 准备 Counter 组件</h2><p>现在 Counter 有了内部 state。我们打算把它干掉，为从 Redux 以 prop 方式获取 <code>count</code> 做准备。</p>
<p>移除顶部的 state 初始化，以及 <code>increment</code> 和 <code>decrement</code> 内部调用的 <code>setState</code>。然后，把 <code>this.state.count</code> 替换成 <code>this.props.count</code>。</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// state = &#123; count: 0 &#125;; // 删除</span></span><br><span class="line"></span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    // 删除</span></span><br><span class="line"><span class="comment">    this.setState(&#123;</span></span><br><span class="line"><span class="comment">      count: this.state.count + 1</span></span><br><span class="line"><span class="comment">    &#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    // 同样删除</span></span><br><span class="line"><span class="comment">    this.setState(&#123;</span></span><br><span class="line"><span class="comment">      count: this.state.count - 1</span></span><br><span class="line"><span class="comment">    &#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;counter&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.decrement&#125;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;count&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">              // 把 state:</span></span><br><span class="line"><span class="xml">              //// this.state.count</span></span><br><span class="line"><span class="xml">              // 替换成:</span></span><br><span class="line"><span class="xml">              this.props.count</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.increment&#125;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在 <code>increment</code> 和 <code>decrement</code> 是空的。我们会很快再次填充它们。</p>
<p>你会注意到 count 消失了 —— 它确实应该这样，因为目前还没有给 <code>Counter</code> 传递 <code>count</code> prop。</p>
<h2 id="连接组件和-Redux"><a href="#连接组件和-Redux" class="headerlink" title="连接组件和 Redux"></a>连接组件和 Redux</h2><p>要从 Redux 获取 <code>count</code>，我们首先需要在 Counter.js 顶部引入 <code>connect</code> 函数。</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>然后我们需要在底部把 Counter 组件和 Redux 连接起来：</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加这个函数:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">count</span>: state.count,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后把:</span></span><br><span class="line"><span class="comment">// export default Counter;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换成:</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(Counter);</span><br></pre></td></tr></table></figure>

<p>之前我们只导出了组件本身。现在我们用 <code>connect</code> 函数调用把它包装起来，这样我们就可以导出<strong>已连接的</strong> Counter。至于应用的其余部分，看起来就像一个常规组件。</p>
<p>然后 count 应该就重新出现了！直到我们重新实现 increment/decrement，它是不会变化的。</p>
<h2 id="如何使用-React-Redux-connect"><a href="#如何使用-React-Redux-connect" class="headerlink" title="如何使用 React Redux connect"></a>如何使用 React Redux <code>connect</code></h2><p>你可能注意到这个调用看起来有点……奇怪。为什么是 <code>connect(mapStateToProps)(Counter)</code> 而不是 <code>connect(mapStateToProps, Counter)</code> 或者 <code>connect(Counter, mapStateToProps)</code>？它做了什么？</p>
<p>这样写是因为 <code>connect</code> 是一个<strong>高阶函数</strong>，它简单说就是当你调用它时会返回一个函数。然后调用<strong>返回的</strong>函数传入一个组件时，它会返回一个新（包装的）组件。</p>
<p>它的另一个名称是 <a target="_blank" rel="noopener" href="https://daveceddia.com/extract-state-with-higher-order-components/"><strong>高阶组件</strong></a> (简称 “HOC”)。HOCs 过去曾有过一些糟糕的新闻，但它仍然是一个相当有用的模式，<code>connect</code> 就是一个很好的例子。</p>
<p><code>Connect</code> 做的是在 Redux 内部 hook，取出整个 state，然后把它传进你提供的 <code>mapStateToProps</code> 函数。它是个自定义函数，因为只有<strong>你</strong>知道你存在 Redux 里面的 state 的“结构”。</p>
<h2 id="mapStateToProps-工作机制"><a href="#mapStateToProps-工作机制" class="headerlink" title="mapStateToProps 工作机制"></a>mapStateToProps 工作机制</h2><p><code>connect</code> 把整个 state 传给了你的 <code>mapStateToProps</code> 函数，就好像在说，“嘿，告诉我你想从这堆东西里面要什么。”</p>
<p><code>mapStateToProps</code> 返回的对象以 props 形式传给了你的组件。以上面为例就是把 <code>state.count</code> 的值用 <code>count</code> prop 传递：对象的属性变成了 prop 名称，它们对应的值会变成 props 的值。你看，这个函数就像字面含义一样<strong>定义从 state 到 props 的映射</strong>。</p>
<p>顺便说说 —— <code>mapStateToProps</code> 的名称是使用惯例，但并不是特定的。你可以简写成 <code>mapState</code> 或者用任何你想的方式调用。只要你接收 <code>state</code> 对象然后返回全是 props 的对象，那就没问题。</p>
<h3 id="为什么不传整个-state？"><a href="#为什么不传整个-state？" class="headerlink" title="为什么不传整个 state？"></a>为什么不传整个 state？</h3><p>在上面的例子中，我们的 state 结构<strong>已经</strong>是对的了，看起来 <code>mapDispatchToProps</code> 可能是不必要的。如果你实质上复制参数（state）给一个跟 state 相同的对象，这有什么意义呢？</p>
<p>在很小的例子中，可能会传全部 state，但通常你只会从更大的 state 集合中选择部分组件需要的数据。</p>
<p>并且，没有 <code>mapStateToProps</code> 函数，<code>connect</code> 不会传递任何 state。</p>
<p>你<strong>可以</strong>传整个 state，然后让组件梳理。但那不是一个很好的习惯，因为组件需要知道 Redux state 的结构然后从中挑选它需要的数据，后面如果你想更改结构会变得更难。</p>
<h2 id="从-React-组件-Dispatch-Redux-Actions"><a href="#从-React-组件-Dispatch-Redux-Actions" class="headerlink" title="从 React 组件 Dispatch Redux Actions"></a>从 React 组件 Dispatch Redux Actions</h2><p>现在我们的 Counter 已经被 <code>connect</code> 了，我们也获取到了 <code>count</code> 值。现在我们如何 dispatch actions 来改变 count？</p>
<p>好吧，<code>connect</code> 为你提供支持：除了传递（mapped）state，它<strong>还</strong>从 store 传递了 <code>dispatch</code> 函数!</p>
<p>要在 Counter 内部 dispatch action，我们可以调用 <code>this.props.dispatch</code> 携带一个 action。</p>
<p>我们的 reducer 已经准备好处理 <code>INCREMENT</code> 和 <code>DECREMENT</code> actions 了，那么接下来从 increment/decrement 中 dispatch：</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.props.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span> &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.props.dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;DECREMENT&#x27;</span> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在我们完成了。按钮应该又重新生效了。</p>
<h3 id="试试这个！加一个重置按钮"><a href="#试试这个！加一个重置按钮" class="headerlink" title="试试这个！加一个重置按钮"></a>试试这个！加一个重置按钮</h3><p>这有个小练习：给 counter 添加“重置”按钮，点击时 dispatch “RESET” action。</p>
<p>Reducer 已经写好处理这个 action，因此你只需要修改 Counter.js。</p>
<h2 id="Action-常量"><a href="#Action-常量" class="headerlink" title="Action 常量"></a>Action 常量</h2><p>在大部分 Redux 应用中，你可以看到 action 常量都是一些简单字符串。这是一个额外的抽象级别，从长远来看可以为你节省不少时间。</p>
<p>Action 常量帮你避免错别字，action 命名的错别字会是一个巨大的痛苦：没有报错，没有哪里坏掉的明显标志，并且你的 action 没有做任何事情？那就可能是个错别字。</p>
<p>Action 常量很容易编写：用变量保存你的 action 字符串。</p>
<p>把这些变量放在一个 <code>actions.js</code> 文件里是个好办法（当你的应用很小时）。</p>
<p>actions.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INCREMENT = <span class="string">&#x27;INCREMENT&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DECREMENT = <span class="string">&#x27;DECREMENT&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>然后你就可以引入这些 action 名称，用它们来代替手写字符串：</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; INCREMENT, DECREMENT &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.dispatch(&#123; <span class="attr">type</span>: INCREMENT &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.dispatch(&#123; <span class="attr">type</span>: DECREMENT &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redux-Action-生成器是什么？"><a href="#Redux-Action-生成器是什么？" class="headerlink" title="Redux Action 生成器是什么？"></a>Redux Action 生成器是什么？</h2><p>现在我们已经手写 action 对象。像个异教徒。</p>
<p>如果你有一个<strong>函数</strong>会为你编写它会怎么样？不要再误写 actinos 了！</p>
<p>我可以告诉你，这很疯狂。手写 <code>&#123; type: INCREMENT &#125;</code> 并保证没有弄乱有多困难？</p>
<p>当你的应用变得越来越大，actions 越来越多，并且这些 actions 开始变得更复杂 —— 要传更多数据而不仅是一个 <code>type</code> —— action 生成器会帮上大忙。</p>
<p>就像 action 常量一样，但它们不是<strong>必须品</strong>。这是另一层的抽象，如果你不想在你的应用里面使用，那也没关系。</p>
<p>不过我还是会解释下它们是什么。然后你可以决定你是否有时/总是/绝不想使用它们。</p>
<p>Actions 生成器在 Redex 术语中是一个简单的函数术语，它返回一个 action 对象。就这些 :)</p>
<p>这是其中两个，返回熟悉的 actions。顺便说一句，它们在 action 常量的 “actions.js” 中完美契合。</p>
<p>actions.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INCREMENT = <span class="string">&#x27;INCREMENT&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DECREMENT = <span class="string">&#x27;DECREMENT&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: INCREMENT &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> decrement = <span class="function">() =&gt;</span> (&#123; <span class="attr">type</span>: DECREMENT &#125;);</span><br></pre></td></tr></table></figure>

<p>我用了两种不同方式——一个 <code>function</code> 和一个箭头函数——来表明你用哪种方式写并不重要。挑选你喜欢的方式就好。</p>
<p>你可能注意到函数命名是小写的（好吧，如果较长的话会是驼峰命名），而 action 常量会是 <code>UPPER_CASE_WITH_UNDERSCORES</code>。同样，这也只是惯例。这会让你一眼区分 action 生成器和 action 常量。但你也可以按你喜欢的方式命名。Redux 并不关心。</p>
<p>现在，如何使用 action 生成器呢？引入然后 dispatch 就好了，当然！</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; increment, decrement &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.dispatch(increment()); <span class="comment">// &lt;&lt; 在这使用</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.dispatch(decrement());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键是要记得调用 action creator()！</p>
<p>不要 <code>dispatch(increment)</code> 🚫</p>
<p>应该 <code>dispatch(increment())</code> ✅</p>
<p>牢记 action 生成器是一个平凡无奇的函数。Dispatch 需要 action 是一个<strong>对象</strong>，而不是函数。</p>
<p>而且：你肯定会在这里出错并且非常困惑。至少一次，或许很多次。那很正常。我有时也<strong>依旧</strong>会忘记。</p>
<h2 id="如何使用-React-Redux-mapDispatchToProps"><a href="#如何使用-React-Redux-mapDispatchToProps" class="headerlink" title="如何使用 React Redux mapDispatchToProps"></a>如何使用 React Redux mapDispatchToProps</h2><p>现在你知道 action 生成器是什么，我们可以讨论<strong>又一个</strong>级别的抽象。（我知道，我<strong>知道</strong>。这是可选的。）</p>
<p>你知道 <code>connect</code> 如何传递 <code>dispatch</code> 函数吗？你知道你是如何厌倦一直敲 <code>this.props.dispatch</code> 并且它看起来多么混乱？（跟我来）</p>
<p>写一个 <code>mapDispatchToProps</code> 对象（或者函数！但通常是对象）然后传给你要包装组件的 <code>connect</code> 函数，你将收到这些 action 生成器作为<strong>可调用 props</strong>。看代码：</p>
<p>Counter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; increment, decrement &#125; <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 我们可以调用 `increment` prop,</span></span><br><span class="line">    <span class="comment">// 它会 dispatch action:</span></span><br><span class="line">    <span class="built_in">this</span>.props.increment();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  decrement = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.decrement();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">count</span>: state.count,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这个对象中, 属性名会成为 prop 的 names,</span></span><br><span class="line"><span class="comment">// 属性值应该是 action 生成器函数.</span></span><br><span class="line"><span class="comment">// 它们跟 `dispatch` 绑定起来.</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Counter);</span><br></pre></td></tr></table></figure>

<p>这很棒，因为它把你从手动调用 <code>dispatch</code> 中解放出来。</p>
<p>你可以把 <code>mapDispatch</code> 写成一个函数，但是对象能满足 95% 你所需的场景。详细内容请看 <a target="_blank" rel="noopener" href="https://daveceddia.com/redux-mapdispatchtoprops-object-form/">函数式 mapDispatch 以及为什么你可能并不需要它</a>。</p>
<h2 id="如何使用-Redux-Thunk-获取数据"><a href="#如何使用-Redux-Thunk-获取数据" class="headerlink" title="如何使用 Redux Thunk 获取数据"></a>如何使用 Redux Thunk 获取数据</h2><p>既然 reducers 应该是“纯”的，我们不能做在 reducer 里面做任何 API 调用或者 dispatch actions。</p>
<p>我们也不能在 action 生成器里面做这些事！</p>
<p>但是如果我们把 action 生成器<strong>返回</strong>一个可以处理我们工作的函数会怎样呢？就像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(<span class="string">&#x27;/current_user&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>越界了，Redux 不支持这种 actions。固执的 Redux 只接受<strong>简单对象</strong>作为 actions。</p>
<p>这时就需要 redux-thunk 了。它是个中间件，基本是 Redux 的一个插件，它可以使 Redux 处理像上面 <code>getUser()</code> 那样的 actions。</p>
<p>你可以像其他 action 生成器一样 dispatch 这些 “thunk actions”：<code>dispatch(getUser())</code>。</p>
<h3 id="“thunk”-是什么？"><a href="#“thunk”-是什么？" class="headerlink" title="“thunk” 是什么？"></a>“thunk” 是什么？</h3><p>“thunk” 是（少见）指被其它函数作为返回值的<strong>函数</strong>。</p>
<p>在 Redux 术语中，它是一个返回值为函数而非简单 action 对象的 action 生成器，就像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doStuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch, getState</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在这里 dispatch actions</span></span><br><span class="line">    <span class="comment">// 或者获取数据</span></span><br><span class="line">    <span class="comment">// 或者该干啥干啥</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从技术角度讲，被返回的函数就是 “thunk”，把它作为返回值的就是“action 生成器”。通常我把它们一起称为 “thunk action”。</p>
<p>Action 生成器返回的函数接收两个参数：<code>dispatch</code> 函数和 <code>getState</code>。</p>
<p>大多数场景你只需要 <code>dispatch</code>，但有时你想根据 Redux state 里面的值额外做些事情。这种情况下，调用 <code>getState()</code> 你就会获得整个 state 的值然后按需所取。</p>
<h2 id="如何安装-Redux-Thunk"><a href="#如何安装-Redux-Thunk" class="headerlink" title="如何安装 Redux Thunk"></a>如何安装 Redux Thunk</h2><p>使用 NPM 或者 Yarn 安装 redux-thunk，运行 <code>npm install --save redux-thunk</code>。</p>
<p>然后，在 index.js（或者其他你创建 store 的地方），引入 <code>redux-thunk</code> 然后通过 Redux 的 <code>applyMiddleware</code> 函数把它应用到 store 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, applyMiddleware(thunk));</span><br></pre></td></tr></table></figure>

<p>必须确保 <code>thunk</code> 包装在 <code>applyMiddleware</code> 调用里面，否则不会生效。不要直接传 <code>thunk</code>。</p>
<h2 id="结合-Redux-请求数据的例子"><a href="#结合-Redux-请求数据的例子" class="headerlink" title="结合 Redux 请求数据的例子"></a>结合 Redux 请求数据的例子</h2><p>设想一下你想展示一个产品列表。你已经获得了后端 API 可以响应 <code>GET /products</code>，所以你创建了一个 thunk action 来从后端请求数据：</p>
<p>productActions.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchProducts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    dispatch(fetchProductsBegin());</span><br><span class="line">    <span class="keyword">return</span> fetch(<span class="string">&#x27;/products&#x27;</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(fetchProductsSuccess(json.products));</span><br><span class="line">        <span class="keyword">return</span> json.products;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> dispatch(fetchProductsFailure(error)));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>fetch(&quot;/products&quot;)</code> 是实际上请求数据的部分。然后我们在它前后分别做了一些 <code>dispatch</code> 调用。</p>
<h2 id="Dispatch-Action-来获取数据"><a href="#Dispatch-Action-来获取数据" class="headerlink" title="Dispatch Action 来获取数据"></a>Dispatch Action 来获取数据</h2><p>要开始调用并且实际获取数据，我们需要 dispatch <code>fetchProducts</code> action。</p>
<p>在哪里调用呢？</p>
<p>如果某一特定的组件需要数据，最好的调用地方通常是在组件刚刚加载<strong>之后</strong>，也就是它的 <code>componentDidMount</code> 生命周期函数。</p>
<p>或者，如果你在使用 Hooks，useEffect hook 里面也是个好地方。</p>
<p>有时你要获取整个应用都需要的真正的<strong>全局</strong>数据 —— 如“用户信息”或者“国际化”。这种场景，就在你创建 store 后使用 <code>store.dispatch</code> 来 dispatch action，而不是等待组件加载后。</p>
<h3 id="如何给-Redux-Actions-命名"><a href="#如何给-Redux-Actions-命名" class="headerlink" title="如何给 Redux Actions 命名"></a>如何给 Redux Actions 命名</h3><p>获取数据的 Redux actions 通常使用标准三连：BEGIN、SUCCESS、FAILURE。这不是硬性要求，只是惯例。</p>
<p>BEGIN/SUCCESS/FAILURE 模式很棒，因为它给你提供钩子来跟踪发生了什么 —— 比如，设置 “loading” 标志为 “true” 以响应 BEGIN 操作，在 SUCCESS 或 FAILURE 之后设为 <code>false</code>。</p>
<p>而且，与 Redux 中的其他所有内容一样，这个也是一个惯例，如果你不需要的话可以忽略掉。</p>
<p>在你调用 API <strong>之前</strong>，dispatch BEGIN action。</p>
<p>调用成功<strong>之后</strong>，你可以 dispatch SUCCESS 数据。如果请求失败，你可以 dispatch 错误信息。</p>
<p>有时最后一个调用 ERROR。其实调用什么一点也不重要，只要你保持一致就好。</p>
<p>注意：dispatch Error action 来处理 FAILURE 会导致你跟踪代码的时候毫无头绪，知道 action 正确 dispatch 但是数据却没更新。吸取我的教训 :)</p>
<p>这是那几个 actions，以及它们的 action 生成器：</p>
<p>productActions.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> FETCH_PRODUCTS_BEGIN = <span class="string">&#x27;FETCH_PRODUCTS_BEGIN&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> FETCH_PRODUCTS_SUCCESS = <span class="string">&#x27;FETCH_PRODUCTS_SUCCESS&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> FETCH_PRODUCTS_FAILURE = <span class="string">&#x27;FETCH_PRODUCTS_FAILURE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchProductsBegin = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">type</span>: FETCH_PRODUCTS_BEGIN,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchProductsSuccess = <span class="function">(<span class="params">products</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">type</span>: FETCH_PRODUCTS_SUCCESS,</span><br><span class="line">  <span class="attr">payload</span>: &#123; products &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchProductsFailure = <span class="function">(<span class="params">error</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">type</span>: FETCH_PRODUCTS_FAILURE,</span><br><span class="line">  <span class="attr">payload</span>: &#123; error &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>接收到 <code>FETCH_PRODUCTS_SUCCESS</code> action 返回的产品数据后，我们写一个 reducer 把它存进 Redux store 中。开始请求时把 <code>loading</code> 标志设为 true，失败或者完成时设为 false。</p>
<p>productReducer.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  FETCH_PRODUCTS_BEGIN,</span><br><span class="line">  FETCH_PRODUCTS_SUCCESS,</span><br><span class="line">  FETCH_PRODUCTS_FAILURE,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./productActions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">items</span>: [],</span><br><span class="line">  <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">productReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> FETCH_PRODUCTS_BEGIN:</span><br><span class="line">      <span class="comment">// 把 state 标记为 &quot;loading&quot; 这样我们就可以显示 spinner 或者其他内容</span></span><br><span class="line">      <span class="comment">// 同样，重置所有错误信息。我们从新开始。</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> FETCH_PRODUCTS_SUCCESS:</span><br><span class="line">      <span class="comment">// 全部完成：设置 loading 为 &quot;false&quot;。</span></span><br><span class="line">      <span class="comment">// 同样，把从服务端获取的数据赋给 items。</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">items</span>: action.payload.products,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> FETCH_PRODUCTS_FAILURE:</span><br><span class="line">      <span class="comment">// 请求失败，设置 loading 为 &quot;false&quot;.</span></span><br><span class="line">      <span class="comment">// 保存错误信息，这样我们就可以在其他地方展示。</span></span><br><span class="line">      <span class="comment">// 既然失败了，我们没有产品可以展示，因此要把 `items` 清空。</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// 当然这取决于你和应用情况：</span></span><br><span class="line">      <span class="comment">// 或许你想保留 items 数据！</span></span><br><span class="line">      <span class="comment">// 无论如何适合你的场景就好。</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: action.payload.error,</span><br><span class="line">        <span class="attr">items</span>: [],</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="comment">// reducer 需要有 default case。</span></span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，我们需要把产品数据传给展示它们并且也负责请求数据的 <code>ProductList</code> 组件。</p>
<p>ProductList.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchProducts &#125; <span class="keyword">from</span> <span class="string">&#x27;/productActions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.dispatch(fetchProducts());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error, loading, products &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error! &#123;error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;products.map((product) =&gt; (</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;product.id&#125;</span>&gt;</span>&#123;product.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        ))&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">products</span>: state.products.items,</span><br><span class="line">  <span class="attr">loading</span>: state.products.loading,</span><br><span class="line">  <span class="attr">error</span>: state.products.error,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(ProductList);</span><br></pre></td></tr></table></figure>

<p>我指的是带有 <code>state.products.&lt;whatever&gt;</code> 的数据而不仅仅是 <code>state.&lt;whatever&gt;</code>，因为我假设你可能会有不止一个 reducer，每一个都处理各自的 state。为了确保这样，我们可以写一个 <code>rootReducer.js</code> 文件把它们放在一起：</p>
<p>rootReducer.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> products <span class="keyword">from</span> <span class="string">&#x27;./productReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  products,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后，当我们创建 store 我们可以传递这个“根” reducer：</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">&#x27;./rootReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br></pre></td></tr></table></figure>

<h2 id="Redux-中错误处理"><a href="#Redux-中错误处理" class="headerlink" title="Redux 中错误处理"></a>Redux 中错误处理</h2><p>这里的错误处理比较轻量，但是对大部分调用 API 的 actions 来说基本结构是一样的。基本观点是：</p>
<ol>
<li>当调用失败时，dispatch 一个 FAILURE action</li>
<li>通过设置一些标志变量和/或保存错误信息来处理 reducer 中的 FAILURE action。</li>
<li>把错误标志和信息（如果有的话）传给需要处理错误的组件，然后根据任何你觉得合适的方式渲染错误信息。</li>
</ol>
<h3 id="能避免重复渲染吗？"><a href="#能避免重复渲染吗？" class="headerlink" title="能避免重复渲染吗？"></a>能避免重复渲染吗？</h3><p>这确实个常见问题。是的，它<strong>会</strong>不止一次触发渲染。</p>
<p>它首先会渲染空 state，然后再渲染 loading state，接着会<strong>再次</strong>渲染展示产品。可怕！三次渲染！（如果你直接跳过 “loading” state 就可以把渲染次数将为两次）</p>
<p>你可能会担心不必要的渲染影响性能，但是不会：单次渲染非常快。如果你在开发的应用肉眼可见的慢的话，分析一下找出慢的原因。</p>
<p>这样想吧：当没有商品或者正在加载或者发生错误的时候应用需要展示<strong>一些东西</strong>。在数据准备好之前，你可能不想只展示一个空白屏幕。这给你了一个提供良好用户体验的机会。</p>
<h2 id="接下来呢？"><a href="#接下来呢？" class="headerlink" title="接下来呢？"></a>接下来呢？</h2><p>希望这篇教程能帮你更加理解 Redux！</p>
<p>如果你想深入了解里面的细节，<a target="_blank" rel="noopener" href="https://redux.js.org/">Redux 文档</a>有很多很好的例子。Mark Erikson (Redux 维护者之一)的博客有一个不错的<a target="_blank" rel="noopener" href="https://blog.isquaredsoftware.com/series/idiomatic-redux/">常用的 Redux 系列</a>。</p>
<p>下周，我会发布一个新课程，<a target="_blank" rel="noopener" href="https://daveceddia.com/pure-redux/">Pure Redux</a>，涵盖这里的所有内容，丰富了更多细节：</p>
<ul>
<li>如何做 immutable 更新</li>
<li>使用 Immer 轻松实现 immutable</li>
<li>使用 Redux DevTools 调试应用</li>
<li>为 reducers、actions 和 thunk actions 编写单元测试</li>
</ul>
<p>还有一整个模块讲解我们创建一个完整的应用，从开始到结束，包含这些：</p>
<ul>
<li>将 CRUD 操作与 Redux 集成 —— 增删查改</li>
<li>创建 API 服务</li>
<li>可访问路由以及路由加载时请求数据</li>
<li>处理模态对话框</li>
<li>将多个 reducer 与 combineReducers 结合使用</li>
<li>如何使用选择器以及 <code>reselect</code> 以提高性能和可维护性</li>
<li>权限和 session 管理</li>
<li>管理员和普通用户视图分离</li>
</ul>
<blockquote>
<p>如果发现译文存在错误或其他需要改进的地方，欢迎到 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 <strong>本文永久链接</strong> 即为本文在 GitHub 上的 MarkDown 链接。</p>
</blockquote>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 是一个翻译优质互联网技术文章的社区，文章来源为 <a target="_blank" rel="noopener" href="https://juejin.im/">掘金</a> 上的英文分享文章。内容覆盖 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#android">Android</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#ios">iOS</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF">前端</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF">后端</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81">产品</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1">设计</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">人工智能</a>等领域，想要查看更多优质译文请持续关注 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a>、<a target="_blank" rel="noopener" href="http://weibo.com/juejinfanyi">官方微博</a>、<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/juejinfanyi">知乎专栏</a>。</p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92/" rel="tag"># 掘金翻译计划</a>
              <a href="/blog/tags/React/" rel="tag"># React</a>
              <a href="/blog/tags/Redux/" rel="tag"># Redux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/2017/12/17/2017/%E3%80%90%E8%AF%91%E3%80%91%E5%A6%82%E4%BD%95%E7%94%A8-TypeScript-%E7%8E%A9%E8%BD%AC%E5%90%8E%E7%AB%AF/" rel="prev" title="【译】如何用 TypeScript 玩转后端？">
                  <i class="fa fa-chevron-left"></i> 【译】如何用 TypeScript 玩转后端？
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/2019/06/17/2019/%E3%80%90%E8%AF%91%E3%80%91Javascript-%E7%AE%80%E6%98%8E%E4%BB%A3%E7%A0%81/" rel="next" title="【译】JavaScript 简明代码 —— 最佳实践">
                  【译】JavaScript 简明代码 —— 最佳实践 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/blog/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xilihuasi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  






  





</body>
</html>
